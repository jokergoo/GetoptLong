<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • GetoptLong</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GetoptLong</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/GetoptLong.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/variable_interpolation.html">UNKNOWN TITLE</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jokergoo/GetoptLong">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jokergoo/GetoptLong/blob/master/vignettes/variable_interpolation.Rmd"><code>vignettes/variable_interpolation.Rmd</code></a></small>
      <div class="hidden name"><code>variable_interpolation.Rmd</code></div>

    </div>

    
    
<!--
%\VignetteEngine{knitr}
%\VignetteIndexEntry{Simple variable interpolation in R}
-->
<div id="simple-variable-interpolation-in-r" class="section level1">
<h1 class="hasAnchor">
<a href="#simple-variable-interpolation-in-r" class="anchor"></a>Simple variable interpolation in R</h1>
<p><strong>Author</strong>: Zuguang Gu ( <a href="mailto:z.gu@dkfz.de">z.gu@dkfz.de</a> )</p>
<p><strong>Date</strong>: 2019-09-29</p>
<hr>
<p>There are several ways to construct strings in <strong>R</strong> such as <code><a href="https://rdrr.io/r/base/paste.html">paste()</a></code>. However, when the string which is going to be constructed is too complex, using <code><a href="https://rdrr.io/r/base/paste.html">paste()</a></code> can be a pain. For example, we want to put some parameters as title in a plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">region =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>)
value =<span class="st"> </span><span class="dv">4</span>
name =<span class="st"> "name"</span>
str =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"region = ("</span>, region[<span class="dv">1</span>], <span class="st">", "</span>, region[<span class="dv">2</span>], <span class="st">"), value = "</span>, value, 
            <span class="st">", name = '"</span>, name, <span class="st">"'"</span>, <span class="dt">sep =</span> <span class="st">""</span>)
<span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(str)</code></pre></div>
<pre><code>## region = (1, 2), value = 4, name = 'name'</code></pre>
<p>As you can see, it is hard to read and very easy to make mistakes. (Syntax highlighting may be helpful to match quotes, but it is still quite annoying to see so many commas and quotes.)</p>
<p>In <strong>Perl</strong>, we always use variable interpolation to construct complex strings in which variables are started with special marks (sigil), and variables will be replaced with their real values. In this package, we aim to implement variable interpolation in <em>R</em>. The idea is rather simple: use special marks to identify variables and then replace with their values. The function here is <code><a href="../reference/qq.html">qq()</a></code> which is named from the subroutine with the same name in <strong>Perl</strong> (It stands for double quote). Using variable interpolation, above example can be written as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(GetoptLong)

str =<span class="st"> </span><span class="kw"><a href="../reference/qq.html">qq</a></span>(<span class="st">"region = (@{region[1]}, @{region[2]}), value = @{value}, name = '@{name}'"</span>)
<span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(str)</code></pre></div>
<pre><code>## region = (1, 2), value = 4, name = 'name'</code></pre>
<p>Or use the shortcut function <code><a href="../reference/qqcat.html">qqcat()</a></code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"region = (@{region[1]}, @{region[2]}), value = @{value}, name = '@{name}'"</span>)</code></pre></div>
<pre><code>## region = (1, 2), value = 4, name = 'name'</code></pre>
<p>One feature of <code><a href="../reference/qqcat.html">qqcat()</a></code> is you can set a global prefix to the messages by <code><a href="../reference/qq.options.html">qq.options("cat_prefix")</a></code>, either a string or a function. If it is set as a function, the value will be generated at real time by executing the function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/qq.options.html">qq.options</a></span>(<span class="st">"cat_prefix"</span> =<span class="st"> "[INFO] "</span>)
<span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"This is a message"</span>)</code></pre></div>
<pre><code>## [INFO] This is a message</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/qq.options.html">qq.options</a></span>(<span class="st">"cat_prefix"</span> =<span class="st"> </span><span class="cf">function</span>() <span class="kw"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span>(), <span class="st">"[%Y-%m-%d %H:%M:%S] "</span>))
<span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"This is a message"</span>)</code></pre></div>
<pre><code>## [2019-09-29 20:50:47] This is a message</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span>(<span class="dv">2</span>)
<span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"This is a message after 2 seconds"</span>)</code></pre></div>
<pre><code>## [2019-09-29 20:50:49] This is a message after 2 seconds</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/qq.options.html">qq.options</a></span>(<span class="st">"cat_prefix"</span> =<span class="st"> ""</span>)
<span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"This is a message"</span>)</code></pre></div>
<pre><code>## This is a message</code></pre>
<p>You can shut down all messages produced by <code><a href="../reference/qqcat.html">qqcat()</a></code> by <code><a href="../reference/qq.options.html">qq.options("cat_verbose" = FALSE)</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/qq.options.html">qq.options</a></span>(<span class="st">"cat_prefix"</span> =<span class="st"> "[INFO] "</span>, <span class="st">"cat_verbose"</span> =<span class="st"> </span><span class="ot">FALSE</span>)
<span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"This is a message"</span>)</code></pre></div>
<p>Also you can set a prefix which has local effect.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/qq.options.html">qq.options</a></span>(<span class="dt">RESET =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/qq.options.html">qq.options</a></span>(<span class="st">"cat_prefix"</span> =<span class="st"> "[DEBUG] "</span>)
<span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"This is a message"</span>, <span class="dt">cat_prefix =</span> <span class="st">"[INFO] "</span>)</code></pre></div>
<pre><code>## [INFO] This is a message</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"This is a message"</span>)</code></pre></div>
<pre><code>## [DEBUG] This is a message</code></pre>
<p>From version 1.1.2, <code><a href="../reference/qq.options.html">qq.options()</a></code> can work in a local mode in which the copy of the options only work in a local chunk.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/qq.options.html">qq.options</a></span>(<span class="st">"cat_prefix"</span> =<span class="st"> "[DEBUG] "</span>)
<span class="kw"><a href="../reference/qq.options.html">qq.options</a></span>(<span class="dt">LOCAL =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/qq.options.html">qq.options</a></span>(<span class="st">"cat_prefix"</span> =<span class="st"> "[INFO] "</span>)
<span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"This is the first message"</span>)</code></pre></div>
<pre><code>## [INFO] This is the first message</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"This is the second message"</span>)</code></pre></div>
<pre><code>## [INFO] This is the second message</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/qq.options.html">qq.options</a></span>(<span class="dt">LOCAL =</span> <span class="ot">FALSE</span>)
<span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"This is the third message"</span>)</code></pre></div>
<pre><code>## [DEBUG] This is the third message</code></pre>
<p>Reset the options so that it does not affect example code in following part of the vignette.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/qq.options.html">qq.options</a></span>(<span class="dt">RESET =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>You can use <code>cat_verbose</code> together with <code><a href="../reference/GetoptLong.html">GetoptLong()</a></code> when you want to run the R script in command line. In following example code, if you do not specify <code>--verbose</code>, all messages will be shut down.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(GetoptLong)
<span class="kw"><a href="../reference/GetoptLong.html">GetoptLong</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
    <span class="st">"verbose"</span>, <span class="st">"Print message"</span>
))
<span class="kw"><a href="../reference/qq.options.html">qq.options</a></span>(<span class="st">"cat_verbose"</span> =<span class="st"> </span>verbose)
<span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"This is a message"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/qq.options.html">qq.options</a></span>(<span class="dt">RESET =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>Not only simple scalars but also pieces of codes can be interpolated:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n =<span class="st"> </span><span class="dv">1</span>
<span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"There @{ifelse(n == 1, 'is', 'are')} @{n} dog@{ifelse(n == 1, '', 's')}.</span><span class="ch">\n</span><span class="st">"</span>)</code></pre></div>
<pre><code>## There is 1 dog.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n =<span class="st"> </span><span class="dv">2</span>
<span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"There @{ifelse(n == 1, 'is', 'are')} @{n} dog@{ifelse(n == 1, '', 's')}.</span><span class="ch">\n</span><span class="st">"</span>)</code></pre></div>
<pre><code>## There are 2 dogs.</code></pre>
<p>If the text is too long, it can be wrapped into lines.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/qq.options.html">qq.options</a></span>(<span class="st">"cat_strwrap"</span> =<span class="st"> </span><span class="ot">TRUE</span>)
<span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"one, two, three, four, five, six, seven, eight, nine, ten, eleven, twelve, thirteen, fourteen, fifteen, sixteen, seventeen, eighteen, nineteen, twenty."</span>)</code></pre></div>
<pre><code>## one, two, three, four, five, six, seven, eight, nine, ten, eleven, twelve, thirteen,
## fourteen, fifteen, sixteen, seventeen, eighteen, nineteen, twenty.</code></pre>
<p><strong>NOTE:</strong> Since <code>qq</code> as the function name is very easy to be used by other packages (E.g., in <strong>lattice</strong>, there is also a <code><a href="../reference/qq.html">qq()</a></code> function as well) and if so, you can enforce <code><a href="../reference/qq.html">qq()</a></code> in your working environment as the function in <strong>GetoptLong</strong> by:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qq =<span class="st"> </span>GetoptLong<span class="op">::</span>qq</code></pre></div>
<div id="code-patterns" class="section level2">
<h2 class="hasAnchor">
<a href="#code-patterns" class="anchor"></a>Code patterns</h2>
<p>In above exmaple, <code>@{}</code> is used to mark variables. Later, variable names will be extracted from these marks and replaced with their real values.</p>
<p>The marking code pattern can be any type. But you should make sure it is easy to tell the difference from other part in the string. You can set your code pattern as an argument in <code><a href="../reference/qq.html">qq()</a></code>. The default pattern is <code>@\\{CODE\\}</code> because we only permit <code>CODE</code> to return simple vectors and <code>@</code> is a sigil representing array in <strong>Perl</strong>.</p>
<p>In following example, the code pattern is <code>#{}</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="dv">1</span>
<span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"x = #{x}"</span>, <span class="dt">code.pattern =</span> <span class="st">"#</span><span class="ch">\\</span><span class="st">{CODE</span><span class="ch">\\</span><span class="st">}"</span>)</code></pre></div>
<pre><code>## x = 1</code></pre>
<p>Or set in <code><a href="../reference/qq.options.html">qq.options()</a></code> as a global setting:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/qq.options.html">qq.options</a></span>(<span class="st">"code.pattern"</span> =<span class="st"> "#</span><span class="ch">\\</span><span class="st">{CODE</span><span class="ch">\\</span><span class="st">}"</span>)</code></pre></div>
<p>As you can guess, in <code>@\\{CODE\\}</code>, <code>CODE</code> will be replaced with <code>.*?</code> to construct a regular expression and to match variable names in the string. So if your <code>code.pattern</code> contains special characters, make sure to escape them. Some candidate <code>code.pattern</code> are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">code.pattern =<span class="st"> "@</span><span class="ch">\\</span><span class="st">{CODE</span><span class="ch">\\</span><span class="st">}"</span>    <span class="co"># default style</span>
code.pattern =<span class="st"> "@</span><span class="ch">\\</span><span class="st">[CODE</span><span class="ch">\\</span><span class="st">]"</span>
code.pattern =<span class="st"> "@</span><span class="ch">\\</span><span class="st">(CODE</span><span class="ch">\\</span><span class="st">)"</span>
code.pattern =<span class="st"> "%</span><span class="ch">\\</span><span class="st">{CODE</span><span class="ch">\\</span><span class="st">}"</span>
code.pattern =<span class="st"> "%</span><span class="ch">\\</span><span class="st">[CODE</span><span class="ch">\\</span><span class="st">]"</span>
code.pattern =<span class="st"> "%</span><span class="ch">\\</span><span class="st">(CODE</span><span class="ch">\\</span><span class="st">)"</span>
code.pattern =<span class="st"> "</span><span class="ch">\\</span><span class="st">$</span><span class="ch">\\</span><span class="st">{CODE</span><span class="ch">\\</span><span class="st">}"</span>
code.pattern =<span class="st"> "</span><span class="ch">\\</span><span class="st">$</span><span class="ch">\\</span><span class="st">[CODE</span><span class="ch">\\</span><span class="st">]"</span>
code.pattern =<span class="st"> "</span><span class="ch">\\</span><span class="st">$</span><span class="ch">\\</span><span class="st">(CODE</span><span class="ch">\\</span><span class="st">)"</span>
code.pattern =<span class="st"> "#</span><span class="ch">\\</span><span class="st">{CODE</span><span class="ch">\\</span><span class="st">}"</span>
code.pattern =<span class="st"> "#</span><span class="ch">\\</span><span class="st">[CODE</span><span class="ch">\\</span><span class="st">]"</span>
code.pattern =<span class="st"> "#</span><span class="ch">\\</span><span class="st">(CODE</span><span class="ch">\\</span><span class="st">)"</span>
code.pattern =<span class="st"> "</span><span class="ch">\\</span><span class="st">[%CODE%</span><span class="ch">\\</span><span class="st">]"</span>  <span class="co"># Template Toolkit (Perl module) style :)</span></code></pre></div>
<p>Since we just replace <code>CODE</code> to <code>.*?</code>, the function will only match to the first right parentheses/brackets. (In <strong>Perl</strong>, I always use recursive regular expression to extract such pairing parentheses. But in <strong>R</strong>, it seems difficult.) So, for example, if you are using <code>@\\[CODE\\]</code> and your string is <code>"@[a[1]]"</code>, it will fail to extract the correct variable name while only extracts <code>a[1</code>, finally it generates an error when executing <code>a[1</code>. In such condition, you should use other pattern styles that do not contain <code>[]</code>.</p>
<p>Finally, I suggest a more safe code pattern style that you do not need to worry about parentheses stuff:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">code.pattern =<span class="st"> "`CODE`"</span></code></pre></div>
</div>
<div id="where-to-look-for-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#where-to-look-for-variables" class="anchor"></a>Where to look for variables</h2>
<p>It will first look up in the envoking environment, then through searching path. Users can also pass values of variables as a list like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="dv">1</span>
y =<span class="st"> </span><span class="dv">2</span>
<span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"x = @{x}, y = @{y}"</span>, <span class="dt">envir =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">x =</span> <span class="st">"a"</span>, <span class="dt">y =</span> <span class="st">"b"</span>))</code></pre></div>
<pre><code>## x = a, y = b</code></pre>
<p>If variables are passed through list, <code><a href="../reference/qq.html">qq()</a></code> only looks up in the specified list.</p>
</div>
<div id="variables-should-only-return-vectors" class="section level2">
<h2 class="hasAnchor">
<a href="#variables-should-only-return-vectors" class="anchor"></a>Variables should only return vectors</h2>
<p><code><a href="../reference/qq.html">qq()</a></code> only allows variables to return vectors. The whole string will be interpolated repeatedly according to longest vectors, and finally concatenated into a single long string.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">6</span>
<span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"@{x} is an @{ifelse(x %% 2, 'odd', 'even')} number.</span><span class="ch">\n</span><span class="st">"</span>)</code></pre></div>
<pre><code>## 1 is an odd number. 2 is an even number. 3 is an odd number. 4 is an even number. 5 is an
## odd number. 6 is an even number.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"a"</span>, <span class="st">"b"</span>)
z =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>)
<span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"@{x}, @{y}, @{z}</span><span class="ch">\n</span><span class="st">"</span>)</code></pre></div>
<pre><code>## 1, a, A 2, b, B 3, a, C 4, b, D 5, a, E 6, b, A</code></pre>
<p>This feature is especially useful if you want to generate a report such as formatted in a HTML table:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">name =<span class="st"> </span>letters[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]
value =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>
<span class="kw"><a href="../reference/qqcat.html">qqcat</a></span>(<span class="st">"&lt;tr&gt;&lt;td&gt;@{name}&lt;/td&gt;&lt;td&gt;@{value}&lt;/td&gt;&lt;tr&gt;</span><span class="ch">\n</span><span class="st">"</span>)</code></pre></div>
<pre><code>## &lt;tr&gt;&lt;td&gt;a&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;tr&gt; &lt;tr&gt;&lt;td&gt;b&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;tr&gt; &lt;tr&gt;&lt;td&gt;c&lt;/td&gt;&lt;td&gt;3&lt;/td&gt;&lt;tr&gt;
## &lt;tr&gt;&lt;td&gt;d&lt;/td&gt;&lt;td&gt;4&lt;/td&gt;&lt;tr&gt;</code></pre>
<p>The returned value can also be a vector while not collapsed into one string:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">str =<span class="st"> </span><span class="kw"><a href="../reference/qq.html">qq</a></span>(<span class="st">"@{x}, @{y}, @{z}"</span>, <span class="dt">collapse =</span> <span class="ot">FALSE</span>)
<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(str)</code></pre></div>
<pre><code>## [1] 6</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">str</code></pre></div>
<pre><code>## [1] "1, a, A" "2, b, B" "3, a, C" "4, b, D" "5, a, E" "6, b, A"</code></pre>
</div>
<div id="you-can-also-interpolate-more-complicated-codes" class="section level2">
<h2 class="hasAnchor">
<a href="#you-can-also-interpolate-more-complicated-codes" class="anchor"></a>You can also interpolate more complicated codes</h2>
<p>Besides simple variables, you can also put chunk of codes in the string. Since <code><a href="../reference/qq.html">qq()</a></code> takes value of the last variable in the chunk as final returning value, you need to explicitly specify the return value in the chunk.</p>
<p>Following example is another way to contruct a HTML table in which the first row is assigned with class name.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">name =<span class="st"> </span>letters[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]
value =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>
str =<span class="st"> </span><span class="kw"><a href="../reference/qq.html">qq</a></span>(<span class="st">"</span>
<span class="st">`</span>
<span class="st">text = character(length(name))</span>
<span class="st">for(i in seq_along(name)) {</span>
<span class="st">    if(i == 1) {</span>
<span class="st">        text[i] = qq(</span><span class="ch">\"</span><span class="st">&lt;tr class='highlight'&gt;&lt;td&gt;@{name[i]}&lt;/td&gt;&lt;td&gt;@{value[i]}&lt;/td&gt;&lt;/tr&gt;</span><span class="ch">\n\"</span><span class="st">)</span>
<span class="st">    } else {</span>
<span class="st">        text[i] = qq(</span><span class="ch">\"</span><span class="st">&lt;tr&gt;&lt;td&gt;@{name[i]}&lt;/td&gt;&lt;td&gt;@{value[i]}&lt;/td&gt;&lt;/tr&gt;</span><span class="ch">\n\"</span><span class="st">)</span>
<span class="st">    }</span>
<span class="st">}</span>
<span class="st">text</span>
<span class="st">`"</span>, <span class="dt">code.pattern =</span> <span class="st">"`CODE`"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(str)</code></pre></div>
<pre><code>## 
## &lt;tr class='highlight'&gt;&lt;td&gt;a&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt;
## 
## &lt;tr&gt;&lt;td&gt;b&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;/tr&gt;
## 
## &lt;tr&gt;&lt;td&gt;c&lt;/td&gt;&lt;td&gt;3&lt;/td&gt;&lt;/tr&gt;
## 
## &lt;tr&gt;&lt;td&gt;d&lt;/td&gt;&lt;td&gt;4&lt;/td&gt;&lt;/tr&gt;</code></pre>
<p>In above example, the string also contains a <code><a href="../reference/qq.html">qq()</a></code> function, so please use different code patterns for them.</p>
</div>
<div id="simple-template-system" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-template-system" class="anchor"></a>Simple template system</h2>
<p>More advanced, you can make a simple template system. E.g., put following code in <code>template.html</code>. In the template, <strong>R</strong> codes are marked by <code>[%</code> and <code>%]</code>. Again, if <code><a href="../reference/qq.html">qq()</a></code> is called inside the <strong>R</strong> codes in the template, you should use different code pattern instead of pattern in the template. That’s why we use a complicated code pattern (<code>[%CODE%]</code>) in the template.</p>
<pre><code>&lt;html&gt;
&lt;body&gt;
&lt;h2&gt;Report for [% report_name %]&lt;/h2&gt;
&lt;table&gt;
&lt;tr&gt;&lt;th&gt;name&lt;/th&gt;&lt;th&gt;value&lt;/th&gt;&lt;/tr&gt;
[% 
i = seq_along(name)
qq("&lt;tr@{ifelse(i == 1, ' class=\"highlight\"', '')}&gt;&lt;td&gt;@{name}&lt;/td&gt;&lt;td&gt;@{value}&lt;/td&gt;&lt;/tr&gt;
")
%]
&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>Read <code>template.html</code> and do the interpolation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">template =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(<span class="st">"template.html"</span>), <span class="dt">collapse =</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)

report_name =<span class="st"> "test"</span>
name =<span class="st"> </span>letters[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]
value =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>
html =<span class="st"> </span><span class="kw"><a href="../reference/qq.html">qq</a></span>(template, <span class="dt">code.pattern =</span> <span class="st">"</span><span class="ch">\\</span><span class="st">[%CODE%</span><span class="ch">\\</span><span class="st">]"</span>)
<span class="kw"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>(html, <span class="dt">con =</span> <span class="st">"report.html"</span>)</code></pre></div>
<p>You will get a report like:</p>
<pre><code>&lt;html&gt; &lt;body&gt; &lt;h2&gt;Report for test&lt;/h2&gt; &lt;table&gt; &lt;tr&gt;&lt;th&gt;name&lt;/th&gt;&lt;th&gt;value&lt;/th&gt;&lt;/tr&gt; &lt;tr
class="highlight"&gt;&lt;td&gt;a&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt;&lt;td&gt;b&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;c&lt;/td&gt;&lt;td&gt;3&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt;&lt;td&gt;d&lt;/td&gt;&lt;td&gt;4&lt;/td&gt;&lt;/tr&gt;

&lt;/table&gt; &lt;/body&gt; &lt;/html&gt;</code></pre>
</div>
<div id="session-info" class="section level2">
<h2 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session info</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>()</code></pre></div>
<pre><code>## R version 3.6.1 (2019-07-05)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS Mojave 10.14.2
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_GB.UTF-8/en_GB.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] GetoptLong_0.1.7 knitr_1.25       markdown_1.1    
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.2          rprojroot_1.3-2     crayon_1.3.4        digest_0.6.21      
##  [5] assertthat_0.2.1    MASS_7.3-51.4       R6_2.4.0            backports_1.1.4    
##  [9] magrittr_1.5        evaluate_0.14       GlobalOptions_0.1.0 stringi_1.4.3      
## [13] rlang_0.4.0         fs_1.3.1            rmarkdown_1.15      pkgdown_1.4.1      
## [17] desc_1.2.0          rjson_0.2.20        tools_3.6.1         stringr_1.4.0      
## [21] xfun_0.9            compiler_3.6.1      memoise_1.1.0       htmltools_0.3.6</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#simple-variable-interpolation-in-r">Simple variable interpolation in R</a><ul class="nav nav-pills nav-stacked">
<li><a href="#code-patterns">Code patterns</a></li>
      <li><a href="#where-to-look-for-variables">Where to look for variables</a></li>
      <li><a href="#variables-should-only-return-vectors">Variables should only return vectors</a></li>
      <li><a href="#you-can-also-interpolate-more-complicated-codes">You can also interpolate more complicated codes</a></li>
      <li><a href="#simple-template-system">Simple template system</a></li>
      <li><a href="#session-info">Session info</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Zuguang Gu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
